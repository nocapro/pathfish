- name: "Basic pipeline: extract and format as pretty JSON"
  options: { format: 'json', pretty: true, strategy: 'regex' }
  input: "File is src/index.ts and another is ./README.md"
  files:
    "src/index.ts": ""
    "./README.md": ""
  expected: |
    [
      "src/index.ts",
      "./README.md"
    ]

- name: "Pipeline with verification, filtering out non-existent paths"
  options: { format: 'list', verify: true, strategy: 'regex' }
  input: "Existing file: file1.txt. Missing file: missing.txt. Existing subdir file: dir/file2.log"
  files:
    'file1.txt': 'content'
    'dir/file2.log': 'log content'
  expected: |
    file1.txt
    dir/file2.log

- name: "Pipeline with absolute path conversion"
  options: { absolute: true, format: 'json', pretty: false, verify: false, strategy: 'regex' } # verification disabled
  input: "Relative path: src/main.js and ./index.html"
  files: {}
  expected: '["{{CWD}}/src/main.js","{{CWD}}/index.html"]'

- name: "Pipeline with verification and absolute path conversion"
  options: { absolute: true, format: 'yaml', verify: true, strategy: 'regex' }
  input: "Real: src/app.ts. Fake: src/fake.ts"
  files:
    'src/app.ts': 'export default {}'
  expected: |
    - {{CWD}}/src/app.ts

- name: "Pipeline with different format (yaml) and no unique"
  options: { format: 'yaml', unique: false, verify: false, strategy: 'regex' }
  input: "path: a.txt, again: a.txt"
  files: {}
  expected: |
    - a.txt
    - a.txt

- name: "Pipeline should produce empty output for no matches"
  options: { format: 'json', strategy: 'regex' }
  input: "Just some regular text without any paths."
  files: {}
  expected: "[]"

- name: "Pipeline with complex paths and query strings"
  options: { format: 'list', verify: false, strategy: 'regex' }
  input: "Path1: /a/b.css?v=1 Path2: src/d.ts#foo Path3: user@domain.com"
  files: {}
  expected: |
    /a/b.css
    src/d.ts

- name: "Pipeline with quoted path with spaces and verification"
  options: { format: 'list', verify: true, strategy: 'regex' }
  input: 'Log: "real dir/real file.txt" and "fake dir/fake file.txt"'
  files:
    'real dir/real file.txt': 'content'
  expected: |
    real dir/real file.txt

- name: "Pipeline with fuzzy strategy and verification"
  options: { format: 'list', verify: true, strategy: 'fuzzy' }
  input: 'I was editing engine.ts and also missing.ts'
  files:
    'src/engine.ts': 'export {}'
    'src/core.ts': 'export {}'
  expected: |
    src/engine.ts

- name: "Fuzzy strategy should not produce false positives for ambiguous basenames"
  options: { format: 'list', verify: false, strategy: 'fuzzy' }
  input: |
    Referencing src/core/db.ts and also src/core/state.ts.
    The file db.ts in packages/konro is not relevant here.
  files:
    'src/core/db.ts': 'content'
    'src/core/state.ts': 'content'
    'packages/konro/src/db.ts': 'content'
  expected: |
    src/core/db.ts
    src/core/state.ts

- name: "Fuzzy strategy should include all candidates for a truly ambiguous basename"
  options: { format: 'list', verify: false, strategy: 'fuzzy' }
  input: "The error is definitely in db.ts, but I'm not sure which one."
  files:
    'src/core/db.ts': 'content'
    'src/core/state.ts': 'content'
    'packages/konro/src/db.ts': 'content'
  expected: |
    src/core/db.ts
    packages/konro/src/db.ts