- name: "should show help text with --help"
  args: ["--help"]
  expected_stdout_contains: "Usage:"
  exit_code: 0

- name: "should show version with --version"
  args: ["--version"]
  expected_stdout_contains: "v" # Will be checked against package.json version
  exit_code: 0

- name: "should read from stdin and output pretty json by default"
  args: []
  stdin: "path is src/index.ts"
  expected_stdout: |
    [
      "src/index.ts"
    ]

- name: "should output compact json with --pretty=false"
  args: ["--pretty=false"]
  stdin: "path is src/index.ts"
  expected_stdout: '["src/index.ts"]'

- name: "should read from a file argument"
  args: ["input.log"]
  files:
    "input.log": "path in file is src/index.ts"
  expected_stdout: |
    [
      "src/index.ts"
    ]

- name: "should output yaml with --format yaml"
  args: ["--format", "yaml"]
  stdin: "src/app.js and src/style.css"
  expected_stdout: |
    - src/app.js
    - src/style.css

- name: "should output a list with --format list"
  args: ["--format", "list"]
  stdin: "src/app.js and src/style.css"
  expected_stdout: |
    src/app.js
    src/style.css

- name: "should verify existing files with --verify"
  args: ["--verify", "--format", "list"]
  stdin: "good: file1.txt, bad: missing.txt"
  files:
    "file1.txt": "content"
  expected_stdout: "file1.txt"

- name: "should make paths absolute with --absolute"
  args: ["--absolute", "--format", "list"]
  stdin: "relative/path.js"
  expected_stdout: "{{CWD}}/relative/path.js"

- name: "should use specified --cwd for absolute paths"
  args: ["--absolute", "--format", "list", "--cwd", "{{CWD}}/fake-root"]
  stdin: "relative/path.js"
  files: # create the fake root so it's a valid directory
    "fake-root/placeholder.txt": ""
  expected_stdout: "{{CWD}}/fake-root/relative/path.js"

- name: "should work with --copy flag (output is unchanged)"
  args: ["--copy", "--format", "list"]
  stdin: "src/main.ts"
  expected_stdout: "src/main.ts"

- name: "should handle a combination of flags"
  args: ["data.log", "--verify", "--absolute", "--format", "yaml"]
  stdin: "" # Reading from file
  files:
    "data.log": "valid: existing.js, invalid: missing.js"
    "existing.js": "export {}"
  expected_stdout: "- {{CWD}}/existing.js"

- name: "should report error and exit 1 if input file does not exist"
  args: ["nonexistent.log"]
  expected_stderr_contains: "Error:"
  exit_code: 1

- name: "should produce empty output for no matches"
  args: ["--format", "list"]
  stdin: "no paths here"
  expected_stdout: ""